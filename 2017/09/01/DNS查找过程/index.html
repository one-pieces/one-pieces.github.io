<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>【转】DNS查找过程 | One Pieces</title>

  
  <meta name="author" content="Xiaolong Lin">
  

  
  <meta name="description" content="当我们在浏览器的地址栏输入网址（譬如：www.google.com），然后回车，回车这一瞬间到看到页面到底发生了什么呢？

域名解析 –&amp;gt; 发起TCP的3次握手 –&amp;gt; 建立TCP连接后发起http请求 –&amp;gt; 服务器响应http请求，浏览器得到html代码 –&amp;gt; 浏览器解析ht">
  

  
  
  <meta name="keywords" content="性能优化,网络请求,DNS,转载">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="【转】DNS查找过程"/>

  <meta property="og:site_name" content="One Pieces"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="One Pieces" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">One Pieces</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>【转】DNS查找过程</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/09/01/DNS查找过程/" rel="bookmark">
        <time class="entry-date published" datetime="2017-09-01T09:30:28.000Z">
          2017-09-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>当我们在浏览器的地址栏输入网址（譬如：<a href="http://www.google.com），然后回车，回车这一瞬间到看到页面到底发生了什么呢？" target="_blank" rel="noopener">www.google.com），然后回车，回车这一瞬间到看到页面到底发生了什么呢？</a></p>
<blockquote>
<p>域名解析 –&gt; 发起TCP的3次握手 –&gt; 建立TCP连接后发起http请求 –&gt; 服务器响应http请求，浏览器得到html代码 –&gt; 浏览器解析html代码，并请求html代码中的资源（如js、css、图片等） –&gt; 浏览器对页面进行渲染呈现给用户</p>
</blockquote>
<p>域名解析是页面加载的第一步，那么域名是如何解析的呢？以Chrome为例：</p>
<ol>
<li><p>Chrome浏览器会首先搜索浏览器自身的DNS缓存（缓存时间比较短，大概只有1分钟，且只能容纳1000条缓存），看自身的缓存中是否有<a href="http://www.google.com对应的条目，而且没有过期，如果有且没有过期则解析到此结束。" target="_blank" rel="noopener">www.google.com对应的条目，而且没有过期，如果有且没有过期则解析到此结束。</a></p>
</li>
<li><p>如果浏览器自身的缓存里面没有找到对应的条目，那么Chrome会搜索操作系统自身的DNS缓存，如果找到且没有过期则停止搜索解析到此结束。<br>注：怎么查看操作系统自身的DNS缓存，以Windows系统为例，可以在命令行下使用<code>ipconfig/displaydns</code>来进行查看。</p>
</li>
<li><p>如果在Windows系统的DNS缓存也没有找到，那么尝试读取hosts文件（位于<code>C:\\Windows\System32\drivers\etc</code>），看看这里面有没有该域名对应的IP地址，如果有则解析成功。</p>
</li>
<li><p>如果在hosts文件中也没有找到对应的条目，浏览器就会发起一个DNS的系统调用，就会想本地配置的首选DNS服务器（一般是电信运营商提供的，也可以使用像Google提供的DNS服务器）发起域名解析请求（通过的是UDP协议向DNS的53端口发起请求，这个请求是递归的请求，也就是运营商的DNS服务器必须得提供给我们该域名的IP地址），运营商的DNS服务器首先查找自身的缓存，找到对应的条目，且没有过期，则解析成功。如果没有找到对应的条目，则由运营商的DNS服务器带我们的浏览器发起迭代DNS解析请求，它首先是会找根域的DNS的IP地址（这个DNS服务器都内置13台根域的DNS的IP地址），找到根域的DNS地址，就会向其发起请求（请问<a href="http://www.google.com这个域名的IP地址是多少？），根域发现这是一个顶级域com域的一个域名，于是就告诉运营商的DNS，我不知道这个域名的IP地址，但是我知道com域的IP地址，你去找它问吧，于是运营商的DNS就得到了com域的IP地址，又向com域的IP地址发起了请求（请问www.google.com这个域名的IP地址是多少？），com域这台服务器告诉运营商的DNS我不知道www.google.com这个域名的IP地址，但是我知道google.com这个域的DNS地址，你找它去吧，于是运营商的DNS又向google.com这个域名的DNS地址(这个一般就是由域名注册商提供的，像万网，新网等)发起请求（请问www.google.com这个域名的IP地址是多少？），这个时候google.com域的DNS服务器一查，咦，果真在我这里，于是就把找到的结果发送给运营商的DNS服务器，这个时候运营商的DNS服务器就拿到了www.google.com这个域名对应的IP地址，并返回给Windows系统内核，内核又把结果返回给浏览器，终于浏览器拿到了www.google.com对应的IP地址，该进行下一步的动作了。" target="_blank" rel="noopener">www.google.com这个域名的IP地址是多少？），根域发现这是一个顶级域com域的一个域名，于是就告诉运营商的DNS，我不知道这个域名的IP地址，但是我知道com域的IP地址，你去找它问吧，于是运营商的DNS就得到了com域的IP地址，又向com域的IP地址发起了请求（请问www.google.com这个域名的IP地址是多少？），com域这台服务器告诉运营商的DNS我不知道www.google.com这个域名的IP地址，但是我知道google.com这个域的DNS地址，你找它去吧，于是运营商的DNS又向google.com这个域名的DNS地址(这个一般就是由域名注册商提供的，像万网，新网等)发起请求（请问www.google.com这个域名的IP地址是多少？），这个时候google.com域的DNS服务器一查，咦，果真在我这里，于是就把找到的结果发送给运营商的DNS服务器，这个时候运营商的DNS服务器就拿到了www.google.com这个域名对应的IP地址，并返回给Windows系统内核，内核又把结果返回给浏览器，终于浏览器拿到了www.google.com对应的IP地址，该进行下一步的动作了。</a><br>注：一般情况下是不会进行以下步骤的，如果经过以上的4个步骤，还没有解析成功，那么会进行如下步骤。</p>
</li>
<li><p>操作系统就会查找NetBIOS name Cache（NetBIOS名称缓存，就存在客户端电脑中），那这个缓存有什么东西呢？凡是最近一段时间内和我成功通讯的计算机的计算机名和IP地址，就都会存在这个缓存里面。什么情况下该步能解析成功呢？就是该名称正好是几分钟前和我成功通信过，那么这一步就可以成功解析。</p>
</li>
<li><p>如果第5步也没有成功，那会查询WINS服务器（是NetBIOS名称和IP地址对应的服务器）</p>
</li>
<li><p>如果第6步也没有查询成功，那么客户端就要进行广播查找</p>
</li>
<li><p>如果第7步也没有成功，那么客户端就读取LMHOSTS文件（和HOSTS文件同一个目录下，写法也一样）</p>
</li>
</ol>
<p>如果第8步还没有解析成功，那么就宣告这次解析失败，那就无法跟目标计算机进行通信。只要这八步中有一步可以解析成功，那就可以成功和目标计算机进行通信。</p>
<p>DNS也是开销，通常浏览器查找一个给定域名的IP地址要花费20~120毫秒，在完成域名解析之前，浏览器不能从服务器加载到任何东西。那么如何减少域名解析时间，加快页面加载速度呢？</p>
<p>当客户端DNS缓存（浏览器和操作系统）缓存为空时，DNS查找的数量与要加载的Web页面中唯一主机名的数量相同，包括页面URL、脚本、样式表、图片、Flash对象等的主机名。减少主机名的数量就可以减少DNS查找的数量。</p>
<p>减少唯一主机名的数量会潜在减少页面中并行下载的数量（HTTP1.1 规范建议从每个主机名并行下载两个组件，但实际上可以多个），这样减少主机名和并行下载的方案会产生矛盾，需要大家自己权衡。建议将组件放到至少两个但不多于4和主机名下，减少DNS查找的同时也允许高度并行下载。</p>
<p> 转自：<a href="http://www.cnblogs.com/MarcoHan/p/5295398.html" target="_blank" rel="noopener">http://www.cnblogs.com/MarcoHan/p/5295398.html</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/性能优化/">性能优化</a><a href="/tags/网络请求/">网络请求</a><a href="/tags/DNS/">DNS</a><a href="/tags/转载/">转载</a>
    </span>
    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 Xiaolong Lin
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>